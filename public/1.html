<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peer Pact Home</title>
    <script type="text/javascript" src="js/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="js/store.min.js"></script>
    <script type="text/javascript" src="js/sitemap.json"></script>
    <!-- uncomment for bootstrap & font-awesome
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.css">
    -->
    <link rel="stylesheet" href="css/milligram.min.css">
    <link rel="stylesheet" href="css/main.css">
    
    
    <script>
      function lookup() {
        var curl = window.location.pathname.split(".html")[0];
        if (curl == "/") { return "index" }
        arr = curl.split("/");
        loc = arr[arr.length-1];
        return loc;
      }
      function exists(loc) {
        // console.log(loc + ".html", navdata[loc + ".html"]);
        return (navdata[loc + ".html"] != null);
      }
      function goNext(loc) {
        var loc = lookup();
        if(loc == "index") {
          if(exists("1")) return '1';
        }
        var loc = loc.split("__").join("-"); // replace '__' with '-'
        var arr = loc.split("_");
        var last = arr.pop();
        var next = "";
        //if last contains a letter
        if (last.match(/[a-z]+/)) {
          next = loc + "_1";
          if(exists(next)) { return next } else {
            return false; //no linear workflow from decision
          }
        } else if (!isNaN(last)) { 
          next = arr.join("_") + (arr.length > 0 ? "_" : "") + last + "__1";
          if(exists(next)) { return next; } else {
            //increment number 
            next = arr.join("_") + (arr.length > 0 ? "_" : "") + (parseInt(last) + 1);
            if(exists(next)) { return next; } else { 
              return false; // end of linear workflow
            }
          }
        } else if(last.includes("-")) {
          insert = last.split("-");
          insertnum = insert.pop();
          // get next inserted number
          next = arr.join("_") + (arr.length > 0 ? "_" : "") + insert.join("__") + (insert.length > 0 ? "__" : "") + (parseInt(insertnum) + 1);
          if(exists(next)) { return next; } else {
            //otherwise, get next linear workflow number
            next = arr.join("_") + (arr.length > 0 ? "_" : "") + (parseInt(insert[0]) + 1);
            if(exists(next)) { return next; } else {
              // end of linear workflow
              return false;
            }
          }
        }
      }
      //testing for goNext
      // console.log("should be 1__1", goNext('1'));
      // console.log("should be 3_a_1", goNext('3_a'));
      // console.log("should be false", goNext('3_b'));
      // console.log("should be 1__2", goNext('1__1'));
      // console.log("should be 2", goNext('1__2'));
      // console.log("should be 3", goNext('2'));
      // console.log("should be 4", goNext('3'));
      // console.log("should be 1", goNext('index'));
      // console.log("should be 8", goNext('7'));
      
      function goPrev() {
        var loc = lookup();
        if(loc == "1") {
          if(exists("index")) return 'index';
        }
        var loc = loc.split("__").join("-"); // replace '__' with '-'
        var arr = loc.split("_");
        var last = arr.pop();
        var next = "";
        //if last contains a letter
        if (last.match(/[a-z]+/)) {
          return false;
        } else if(!isNaN(last)) { // if last is a number
          var counter = 1;
          var prev = (parseInt(last) - 1);
          if(prev < 0) {
            prev = 0;
          }
          // find out if there are any inserts
          next = arr.join("_") + (arr.length > 0 ? "_" : "") + prev + "__" + counter;
          while(exists(next)) { // find last insert
            counter += 1;
            next = arr.join("_") + (arr.length > 0 ? "_" : "") + prev + "__" + counter;
          } // went one too far, go back one
          next = arr.join("_") + (arr.length > 0 ? "_" : "") + prev + "__" + (counter-1);
          if(exists(next)) { return next; } else {
            if(prev == 0) {
              next = arr.join("_");   
            } else {
              next = arr.join("_") + (arr.length > 0 ? "_" : "") + prev;
            }
            if(exists(next)) { return next; } else { return false; } // otherwise no
          }
        } else if(last.includes("-")) {
          insert = last.split("-");
          insertnum = insert.pop();
          var prev = parseInt(insertnum) - 1;
          if(prev == 0) {
            next = arr.join("_") + (arr.length > 0 ? "_" : "") + insert.join("__");
          } else {
            next = arr.join("_") + (arr.length > 0 ? "_" : "") + insert.join("__") + (insert.length > 0 ? "__" : "") + prev;
          }  
          if(exists(next)) { return next; } else {
            // end of linear workflow
            return false;
          }
        
        }
      }
      // //testing for goPrev
      // console.log("should be 1__2", goPrev('2'));
      // console.log("should be 3_a_1", goPrev('3_a_2'));
      // console.log("should be 3_a", goPrev('3_a_1'));
      // console.log("should be false", goPrev('3_a'));
      // console.log("should be false", goPrev('3_b'));
      // console.log("should be 1__1", goPrev('1__2'));
      // console.log("should be 1", goPrev('1__1'));
      // console.log("should be 2", goPrev('3'));
      // console.log("should be 3", goPrev('4'));
      // console.log("should be index", goPrev('1'));
      // console.log("should be 8", goPrev('9'));
      
      function goStart() {
        return 'index';
      }
      
      function goParent(loc) {
        // var loc = lookup();
        if(loc == "index") {
          return false
        }
        var loc = loc.split("__").join("-"); // replace '__' with '-'
        var arr = loc.split("_");
        var last = arr.pop();
        var next = "";
        //if last contains a letter
        if (last.match(/[a-z]+/)) {
          next = arr.join("_");
          if(exists(next)) { return next } else {
            return false; //things are broken
          }
        } else { // everything else doesn't have a parent...
          return false;
        }
      }
      //testing for goParent
      // console.log("should be false", goParent('2'));
      // console.log("should be false", goParent('3_a_2'));
      // console.log("should be false", goParent('3_a_1'));
      // console.log("should be 3", goParent('3_a'));
      // console.log("should be 3", goParent('3_b'));
      // console.log("should be false", goParent('1__2'));
      // console.log("should be false", goParent('1__1'));
      // console.log("should be false", goParent('3'));
      // console.log("should be false", goParent('4'));
      // console.log("should be false", goParent('1'));
      // console.log("should be false", goParent('9'));

      function goChild(loc, child) {
        // var loc = lookup();
        var loc = loc.split("__").join("-"); // replace '__' with '-'
        var arr = loc.split("_");
        var last = arr.pop();
        var next = "";
        //if last contains a letter switch between various children
        if (last.match(/[a-z]+/)) { 
          next = arr.join("_") + (arr.length > 0 ? "_" : "") + child;
          if(exists(next)) { return next } else {
            return false; //selected wrong child
          }
        } else { // otherwise, select child on the parent
          var next = loc + "_" + child;
          if (exists(next)) { return next; } else {
            return false; // no children
          }
        }
      }
      // //testing for goChild
      // console.log("should be false", goChild('2', 'a'));
      // console.log("should be 3_d", goChild('3_a', 'd'));
      // console.log("should be false", goChild('3_a_1'));
      // console.log("should be 3_a", goChild('3_a', 'a'));
      // console.log("should be 3_c", goChild('3_b', 'c'));
      // console.log("should be 3_b", goChild('3', 'b'));
      // console.log("should be 3_b", goChild('3_a', 'b'));
      // console.log("should be false", goChild('3', 'e'));
      // console.log("should be false", goChild('4'));
      // console.log("should be false", goChild('1'));
      // console.log("should be false", goChild('9'));

      function setupAutoNav() {
        $(".pknav").click(function() {
          var chooser = {
            'next': goNext,
            'prev': goPrev,
            'parent': goParent,
            'start': goStart,
            'index': goStart,
            'child': goChild
          };
          var classes = $(this).attr('class').split(' ');
          for (var i=0; i< classes.length;i++) {
            var c = classes[i];
            if(c.includes("child")) {
              var d = c.split("-")
              var link = chooser[d[0]](d[1]);
            } else if (c !== '' && c !== 'pknav') {
              var link = chooser[c]();
            }    
            if(link) {
                console.log("page detected, going to:", link + ".html");
                window.location.href = link + ".html";
              }  
          }
        });
      }
      $().ready(function() {
        setupAutoNav();
      })
    </script>
  </head>
  <body>
    <div class="narrator-bar hide">View Narrator</div>
    <div class="narrator">
      <script> 
        function hideNarrator() {
          $(".narrator").addClass("hide");
          $(".narrator-bar").removeClass("hide");
        }
        function showNarrator() {
          $(".narrator").removeClass("hide");
          $(".narrator-bar").addClass("hide");
        }
        $().ready(function() {
          console.log($(".narrator .content").text().trim().length);
          if($(".narrator .content").text().trim().length == 0) {
            hideNarrator();
          }
          $(".narrator .close").click(function() {
            hideNarrator();
          });
          $(".narrator-bar").click(function() {
            showNarrator();
          })
        });
      </script>
      <div class="close">×</div>
      <div class="content">
      
      
      </div>
      <div class="nav">
        <a class="pknav restart">Restart</a>
        <a class="pknav prev">Prev</a>
        <a class="pknav next">Next</a>
      </div>
    </div>

    <div class="container">
      
      <div class="content">
        
	<div class="row">
		<h2>Welcome to PeerPact!</h2>
		<p>I want to:</p>
		<div class="chooser">
			<script>
				$().ready(function() {
					$(".chooser").find("a:contains(" + store.get("project-type") + ")").addClass("selected");
					$(".change-project-type").html(store.get("project-type"));
					$(".change-project-date").html(store.get("project-day") + ", " + store.get("project-time"));
					$(".chooser a").click(function() {
						$(".chooser a.selected").removeClass("selected");
						$(this).addClass("selected");
						store.set("project-type", $(this).html());
						$(".change-project-type").html(store.get("project-type"));
					});
					//day
					$("#project-day").val(store.get("project-day"));
					$("#project-day").change(function() {
						store.set("project-day", $(this).val());
						$(".change-project-date").html(store.get("project-day") + ", " + store.get("project-time"));
					});
					$("#project-time").val(store.get("project-time"));
					$("#project-time").change(function() {
						store.set("project-time", $(this).val());
						$(".change-project-date").html(store.get("project-day") + ", " + store.get("project-time"));
					});
					$("#project-commit").prop("checked", store.get("project-commit"));
					$("#project-commit").change(function() {
						store.set("project-commit", this.checked);
						
				});
				})
			</script>
			<a>Write</a>
			<a>Draw</a>
			<a>Create</a>
			<a>Code</a>
		</div>
		<p>every week. My turn in date for work will be on:</p>
		<select id="project-day">
			<option value=""></option>
			<option value="Sunday">Sunday</option>
			<option value="Monday">Monday</option>
			<option value="Tuesday">Tuesday</option>
			<option value="Wednesday">Wednesday</option>
			<option value="Thursday">Thursday</option>
			<option value="Friday">Friday</option>
			<option value="Saturday">Saturday</option>
		</select>
		at
		<select id="project-time">
			<option value="6am">6am</option>
			<option value="7am">7am</option>
			<option value="8am">8am</option>
			<option value="9am">9am</option>
			<option value="10am">10am</option>
			<option value="11am">11am</option>
			<option value="12pm">12pm</option>
			<option value="1pm">1pm</option>
			<option value="2pm">2pm</option>
			<option value="3pm">3pm</option>
			<option value="4pm">4pm</option>
			<option value="5pm">5pm</option>
			<option value="6pm">6pm</option>
			<option value="7pm">7pm</option>
			<option value="8pm">8pm</option>
			<option value="9pm">9pm</option>
			<option value="10pm">10pm</option>
			<option value="11pm">11pm</option>
			<option value="12am">12am</option>
			<option value="1a<">1a</option>
			<option value="2am">2am</option>
			<option value="3am">3am</option>
			<option value="4am">4am</option>
			<option value="5am">5am</option>
		</select>
		<br><br><br>
		<input type="checkbox" id="project-commit"> I pledge to <b class="change-project-type">write</b> something every week <br> and have something to show each week by <b class="change-project-date">Thursday, 9pm</b>.
		<br><br>
		<a href="2.html">Next</a>
	</div>

      </div>
    </div>
  </body>
  
  
</html>