<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}}</title>
    <script type="text/javascript" src="js/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="js/jsform.min.js"></script>
    <script type="text/javascript" src="js/store.min.js"></script>
    <script type="text/javascript" src="js/sitemap.json"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.css">
    <!-- uncomment for bootstrap & font-awesome
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    -->
    <link rel="stylesheet" href="css/main.css">
    {% block css %}
    {% endblock %}
    {% include "auto-links.njk" %}
  </head>
  <body>
    <script>
      // add sync into localstorage to forms
      // this is a wrapper around jsForms
      function pkls() {
        $(".pkls").each(function() {
          var $this = $(this);
          if($(this).is("form")) {
            function getFormName(attr) {
              if(attr.includes('.')) {
                var p = attr.split(".")[0];
              } else {
                var p = "data";
              }  
              return p;
            }
            var p = getFormName($(this).find("[name]").first().attr("name"));
            // set up form to load values.            
            $(this).jsForm({
              data: store.get(p),
              prefix: p
            })  
            // form button save to localstorage.
            $(this).find(".pksave").click(function(e) {
              e.preventDefault();
              var arr = $this.jsForm("get");
              var p = getFormName($(this).find("[name]").first().attr("name"));
              store.set(p, arr);
            })
          }
        });
      }
      function hideNarrator() {
        $(".narrator").addClass("hide");
        // change icon to show
        if($(".narrator .message-body").text().trim().length > 0) {
          $(".narrator-bar .open i").removeClass().addClass("fa fa-commenting")
        } else {
          $(".narrator-bar .open i").removeClass().addClass("fa fa-comment-o")
        }
      }
      function showNarrator() {
        $(".narrator").removeClass("hide");
        $(".narrator-bar .open i").removeClass().addClass("fa fa-commenting-o")
      }
      $().ready(function() {
        pkls();
        if($(".narrator .message-body").text().trim().length == 0) {
          hideNarrator(); // hide narrator also changes the icon
        }
        $(".narrator .delete").click(function() {
          hideNarrator();
        });
        $(".narrator-bar .open").click(function() {
          if($(".narrator").hasClass("hide")) {
            showNarrator();  
          } else {
            hideNarrator();
          }
          
        })
      });
    </script>

    <div class="narrator-bar">
      <a class="pknav restart">Home</a>
      <a class="pknav prev">Prev</a>
      <a class="pknav next">Next</a>
      <a class="open"><span class="icon"><i class="fa fa-commenting"></i></span></a>
    </div>

    <div class="narrator message is-info">
      <div class="message-header">
        <p>Narrator</p>
        <button class="delete"></button>
      </div>
      <div class="message-body">
        {% block narrator %}
        {% endblock %}
      </div>
    </div>
    {% block content %}
    {% endblock %}
  </body>
  {% block js %}
  {% endblock %}
</html>